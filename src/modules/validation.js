import { formatDate } from "./date";
import { elementBuilder } from "./elements";

const priorErrorCheck = (parent) => {
  let messageElement = Array.from(parent.children)[2];

  if (messageElement !== undefined) {
    messageElement.remove();
  }
};

const priorityCheck = (value) => {
  if (value <= 5) {
    return true;
  } else {
    return false;
  }
};

const validation = (obj) => {
  const check = [];
  for (let prop in obj) {
    let value = obj[prop][0];
    let element = obj[prop][1];
    priorErrorCheck(element);
    if (value == "") {
      let errorMessage = elementBuilder("p", "invalid", element);
      errorMessage.classList.add("blank");
      errorMessage.textContent = "Please enter a value for this field.";
      check.push(false);
    }
  }
  let dateElement = obj.datePair[1];
  let dueDate = formatDate(obj.datePair[0]);
  if (!dueDate) {
    priorErrorCheck(dateElement);
    let errorMessage = elementBuilder("p", "invalid", dateElement);
    errorMessage.classList.add("date");
    errorMessage.textContent = "Please enter a valid date.";
    check.push(false);
  }

  let priorityElement = obj.priorityPair[1];
  if (!priorityCheck(obj.priorityPair[0])) {
    priorErrorCheck(priorityElement);
    let errorMessage = elementBuilder("p", "invalid", priorityElement);
    errorMessage.classList.add("priority-num");
    errorMessage.textContent = "Please enter a number 1-5.";
    check.push(false);
  }

  if (check.length > 0) {
    return false;
  } else {
    return [true, dueDate];
  }
};

const validateProj = (obj) => {
  const check = [];
  for (let prop in obj) {
    let value = obj[prop][0];
    let element = obj[prop][1];
    priorErrorCheck(element);
    if (value == "") {
      let errorMessage = elementBuilder("p", "invalid", element);
      errorMessage.classList.add("blank");
      errorMessage.textContent = "Please enter a value for this field.";
      check.push(false);
    }
  }

  if (check.length > 0) {
    return false;
  } else {
    return true;
  }
};

export { validation, validateProj };